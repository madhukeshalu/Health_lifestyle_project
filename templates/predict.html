{% extends "base.html" %}

{% block title %}Risk Assessment - HealthGuard{% endblock %}
<!-- In predict.html -->
<form method="POST" action="{{ url_for('predict') }}" id="healthForm">
{% block head_extra %}
<style>
    .assessment-header {
        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
        color: white;
        padding: 60px 0;
        margin-top: -20px;
        border-radius: 0 0 20px 20px;
    }
    
    .form-section {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        border: 1px solid #eaeaea;
    }
    
    .form-section-title {
        border-bottom: 3px solid #6a11cb;
        padding-bottom: 10px;
        margin-bottom: 25px;
        color: #333;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<!-- Assessment Header -->
<div class="assessment-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-5 fw-bold mb-3">Health Risk Assessment</h1>
                <p class="lead mb-0">Complete this form to get your personalized health insights</p>
            </div>
            <div class="col-lg-4 text-lg-end">
                <div class="card bg-white text-dark">
                    <div class="card-body">
                        <h5><i class="fas fa-clock text-primary me-2"></i>Quick Facts</h5>
                        <ul class="list-unstyled mt-3">
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> Takes 3-5 minutes</li>
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> Instant Results</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i> Free & Secure</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Assessment Form -->
<div class="container mt-5">
    <div class="row">
        <div class="col-lg-12">
            <form method="POST" action="{{ url_for('predict') }}" id="healthForm">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }} alert-dismissible fade show">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <!-- Personal Information -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-user-circle me-2"></i>Personal Information
                    </h3>
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <label class="form-label">Age (years) *</label>
                            <input type="number" class="form-control" name="age" id="age" min="18" max="100" required 
                                   value="{{ session.prediction_data.age if session.prediction_data else '' }}">
                            <small class="text-muted">Must be between 18-100 years</small>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <label class="form-label">Gender *</label>
                            <select class="form-select" name="gender" id="gender" required>
                                <option value="">Select Gender</option>
                                <option value="Male" {% if session.prediction_data and session.prediction_data.gender == 'Male' %}selected{% endif %}>Male</option>
                                <option value="Female" {% if session.prediction_data and session.prediction_data.gender == 'Female' %}selected{% endif %}>Female</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <label class="form-label">Height (cm) *</label>
                            <input type="number" class="form-control" name="height_cm" id="height_cm" min="100" max="250" required 
                                   value="{{ session.prediction_data.height_cm if session.prediction_data else '' }}">
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <label class="form-label">Weight (kg) *</label>
                            <input type="number" step="0.1" class="form-control" name="weight_kg" id="weight_kg" min="30" max="200" required 
                                   value="{{ session.prediction_data.weight_kg if session.prediction_data else '' }}">
                        </div>
                    </div>
                </div>

                <!-- Lifestyle Factors -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-running me-2"></i>Lifestyle Factors
                    </h3>
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <label class="form-label">Physical Activity (hours/week) *</label>
                            <input type="number" step="0.5" class="form-control" name="physical_activity_hours_per_week" 
                                   min="0" max="40" required value="{{ session.prediction_data.physical_activity_hours_per_week if session.prediction_data else '3' }}">
                            <small class="text-muted">Recommended: 2.5+ hours</small>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <label class="form-label">Sleep Hours (per day) *</label>
                            <input type="number" step="0.5" class="form-control" name="sleep_hours_per_day" 
                                   min="0" max="24" required value="{{ session.prediction_data.sleep_hours_per_day if session.prediction_data else '7' }}">
                            <small class="text-muted">Recommended: 7-9 hours</small>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <label class="form-label">Daily Screen Time (hours) *</label>
                            <input type="number" step="0.5" class="form-control" name="daily_screen_time_hours" 
                                   min="0" max="24" required value="{{ session.prediction_data.daily_screen_time_hours if session.prediction_data else '6' }}">
                            <small class="text-muted">Recommended: < 6 hours</small>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <label class="form-label">Water Intake (liters/day) *</label>
                            <input type="number" step="0.1" class="form-control" name="water_intake_liters" 
                                   min="0" max="10" required value="{{ session.prediction_data.water_intake_liters if session.prediction_data else '2' }}">
                            <small class="text-muted">Recommended: 2+ liters</small>
                        </div>
                    </div>
                </div>

                <!-- Health Habits -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-apple-alt me-2"></i>Health Habits
                    </h3>
                    
                    <div class="row">
                        <div class="col-md-4 mb-4">
                            <label class="form-label">Diet Quality *</label>
                            <select class="form-select" name="diet_quality" required>
                                <option value="">Select</option>
                                <option value="Poor" {% if session.prediction_data and session.prediction_data.diet_quality == 'Poor' %}selected{% endif %}>Poor</option>
                                <option value="Average" {% if session.prediction_data and session.prediction_data.diet_quality == 'Average' %}selected{% endif %}>Average</option>
                                <option value="Good" {% if session.prediction_data and session.prediction_data.diet_quality == 'Good' %}selected{% endif %}>Good</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4 mb-4">
                            <label class="form-label">Stress Level *</label>
                            <select class="form-select" name="stress_level" required>
                                <option value="">Select</option>
                                <option value="Low" {% if session.prediction_data and session.prediction_data.stress_level == 'Low' %}selected{% endif %}>Low</option>
                                <option value="Medium" {% if session.prediction_data and session.prediction_data.stress_level == 'Medium' %}selected{% endif %}>Medium</option>
                                <option value="High" {% if session.prediction_data and session.prediction_data.stress_level == 'High' %}selected{% endif %}>High</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4 mb-4">
                            <label class="form-label">Smoking Status *</label>
                            <select class="form-select" name="smoking_status" required>
                                <option value="">Select</option>
                                <option value="Non-smoker" {% if session.prediction_data and session.prediction_data.smoking_status == 'Non-smoker' %}selected{% endif %}>Non-smoker</option>
                                <option value="Occasional" {% if session.prediction_data and session.prediction_data.smoking_status == 'Occasional' %}selected{% endif %}>Occasional</option>
                                <option value="Regular" {% if session.prediction_data and session.prediction_data.smoking_status == 'Regular' %}selected{% endif %}>Regular</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-4">
                            <label class="form-label">Alcohol Consumption *</label>
                            <select class="form-select" name="alcohol_consumption" required>
                                <option value="">Select</option>
                                <option value="Moderate" {% if session.prediction_data and session.prediction_data.alcohol_consumption == 'Moderate' %}selected{% endif %}>Moderate</option>
                                <option value="High" {% if session.prediction_data and session.prediction_data.alcohol_consumption == 'High' %}selected{% endif %}>High</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4 mb-4">
                            <label class="form-label">Fast Food (times/week) *</label>
                            <input type="number" class="form-control" name="fast_food_frequency_per_week" 
                                   min="0" max="21" required value="{{ session.prediction_data.fast_food_frequency_per_week if session.prediction_data else '2' }}">
                        </div>
                        
                        <div class="col-md-4 mb-4">
                            <label class="form-label">Mental Wellbeing Score *</label>
                            <input type="range" class="form-range" id="mentalWellbeingSlider" min="0" max="100" 
                                   name="mental_wellbeing_score" value="{{ session.prediction_data.mental_wellbeing_score if session.prediction_data else '50' }}">
                            <div class="d-flex justify-content-between">
                                <small>0</small>
                                <span id="sliderValue">50</span>
                                <small>100</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Medical History -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-history me-2"></i>Medical History
                    </h3>
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <label class="form-label">Chronic Conditions *</label>
                            <select class="form-select" name="chronic_conditions" required>
                                <option value="">Select</option>
                                <option value="None" {% if session.prediction_data and session.prediction_data.chronic_conditions == 'None' %}selected{% endif %}>None</option>
                                <option value="Diabetes" {% if session.prediction_data and session.prediction_data.chronic_conditions == 'Diabetes' %}selected{% endif %}>Diabetes</option>
                                <option value="Hypertension" {% if session.prediction_data and session.prediction_data.chronic_conditions == 'Hypertension' %}selected{% endif %}>Hypertension</option>
                                <option value="Other" {% if session.prediction_data and session.prediction_data.chronic_conditions == 'Other' %}selected{% endif %}>Other</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <label class="form-label">Family History of Disease *</label>
                            <select class="form-select" name="family_history" required>
                                <option value="">Select</option>
                                <option value="No" {% if session.prediction_data and session.prediction_data.family_history == 'No' %}selected{% endif %}>No</option>
                                <option value="Yes" {% if session.prediction_data and session.prediction_data.family_history == 'Yes' %}selected{% endif %}>Yes</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-section">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        All information provided is confidential and used only for health assessment purposes.
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <button type="reset" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-redo me-2"></i>Clear Form
                        </button>
                        <button type="submit" class="btn btn-primary btn-lg px-5">
                            <i class="fas fa-calculator me-2"></i>Calculate Health Risk
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Simple JavaScript without complex validation
    
    // Update slider value display
    const slider = document.getElementById('mentalWellbeingSlider');
    const sliderValue = document.getElementById('sliderValue');
    
    if (slider && sliderValue) {
        function updateSliderDisplay() {
            sliderValue.textContent = slider.value;
        }
        
        slider.addEventListener('input', updateSliderDisplay);
        updateSliderDisplay(); // Initialize
    }
    
    // Simple form validation
    document.getElementById('healthForm').addEventListener('submit', function(e) {
        let isValid = true;
        const requiredSelects = this.querySelectorAll('select[required]');
        
        requiredSelects.forEach(select => {
            if (!select.value) {
                isValid = false;
                select.classList.add('is-invalid');
                
                // Add error message if not exists
                if (!select.nextElementSibling || !select.nextElementSibling.classList.contains('invalid-feedback')) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'invalid-feedback';
                    errorDiv.textContent = 'Please select an option';
                    select.parentNode.appendChild(errorDiv);
                }
            } else {
                select.classList.remove('is-invalid');
                const errorDiv = select.nextElementSibling;
                if (errorDiv && errorDiv.classList.contains('invalid-feedback')) {
                    errorDiv.remove();
                }
            }
        });
        
        if (!isValid) {
            e.preventDefault();
            alert('Please fill in all required fields.');
        }
    });
    
    // Remove error class on change
    document.querySelectorAll('select').forEach(select => {
        select.addEventListener('change', function() {
            this.classList.remove('is-invalid');
            const errorDiv = this.nextElementSibling;
            if (errorDiv && errorDiv.classList.contains('invalid-feedback')) {
                errorDiv.remove();
            }
        });
    });
</script>
{% endblock %}